<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì–‘ë™ì´ ì±—ë´‡ ë©”ì¸ í˜ì´ì§€</title>
<style>
  :root{
    --brand:#1565d8; --brand-dark:#0f4aa4;
    --bg:#f3f6fb; --card:#ffffff;
    --text:#1f2a37; --muted:#6b7280;
    --shadow:0 8px 24px rgba(0,0,0,.06);
    --sbw:260px;
    --assist-shift: 120px;
  }

  body.dark {
  --bg: #111827;
  --card: #1f2937;
  --text: #f3f4f6;
  --muted: #9ca3af;
  --brand: #3b82f6;
  --brand-dark: #2563eb;
  background: var(--bg);
  color: var(--text);
}

body.dark .panel,
body.dark .tile,
body.dark .settings-panel {
  background: var(--card);
  color: var(--text);
  box-shadow: 0 8px 30px rgba(0,0,0,0.5);
}

body.dark .tile .s,
body.dark .muted {
  color: var(--muted);
}

body.dark .assistant-bar {
  background: #374151;
}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:"Pretendard","Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,"Malgun Gothic",sans-serif;
  }

  /* ===== Sidebar ===== */
  .sidebar{
    position:fixed; inset:0 auto 0 0; width:var(--sbw); height:100vh;
    background:linear-gradient(180deg,var(--brand),var(--brand-dark));

    color:#fff; display:flex; flex-direction:column; padding:18px 14px;
    transition:transform .25s ease; z-index:50;
  }
  body.sidebar-closed .sidebar{ transform:translateX(-100%); }

  .sb-top{display:flex; align-items:center; gap:10px; padding:8px 10px 14px 8px; border-bottom:1px solid rgba(255,255,255,.18); margin-bottom:12px;}
  .logo{display:flex; align-items:center; gap:10px; font-weight:700; font-size:18px;}
  .logo img{width:28px; height:28px; border-radius:50%; background:#fff}
  .sb-links{display:flex; flex-direction:column; gap:6px; padding:10px 0}
  .sb-item{
    display:flex; align-items:center; gap:10px; padding:12px; border-radius:10px;
    color:#eaf2ff; text-decoration:none; cursor:pointer; transition:background .18s ease;
  }
  .sb-item .icon{width:22px; height:22px; display:grid; place-items:center; background:rgba(255,255,255,.18); border-radius:8px; font-size:13px}
  .sb-item:hover{background:rgba(255,255,255,.14)}
  .sb-item.active{background:#fff; color:var(--brand)}
  .sb-bottom{margin-top:auto; display:flex; align-items:center; gap:10px; padding:10px 12px; opacity:.9}
  .sb-bottom img{width:44px; height:44px; border-radius:50%; background:#fff}
  .sb-bottom .role{font-size:12px; opacity:.9}

  .log-card {
  padding: 12px;
  border-radius: 8px;
  background:#f0f2f5;
  margin-bottom: 10px;
  cursor: pointer;
}
.log-card:hover { background:#e3e5e8; }

.bubble {
  padding: 10px 14px;
  margin: 8px 0;
  border-radius: 10px;
  max-width: 80%;
}
.bubble.USER { background:#d2e3ff; text-align:left; }
.bubble.BOT { background:#eee; text-align:left; margin-left:auto; }


  /* ===== Main ===== */
  .main{ min-height:100vh; display:flex; flex-direction:column; margin-left:var(--sbw); transition:margin-left .25s ease; }
  body.sidebar-closed .main{ margin-left:0; }

  .topbar{
    height:64px; background:#fff; box-shadow:var(--shadow);
    padding:0 16px; display:flex; align-items:center; gap:8px; justify-content:space-between;
    position: sticky; top:0; z-index:60;
  }
  .auth-btn{ padding:6px 12px; border:none; border-radius:8px; cursor:pointer; background:#1565d8; color:#fff; font-weight:600; transition:background .2s ease;}
  .auth-btn:hover{ background:#0f4aa4; }
  .left-group{display:flex; align-items:center; gap:8px;}
  .sb-toggle{
    border:none; background:transparent; width:40px; height:40px; border-radius:10px;
    font-size:18px; cursor:pointer; display:grid; place-items:center; color:#1f2a37;
  }
  .sb-toggle:hover{background:#eef3ff}
  .topbar .title{font-weight:700; font-size:18px}
  .right{display:flex; align-items:center; gap:12px; color:var(--muted)}

  .content{flex:1; padding:50px; position:relative;}
  
  .board{height:100%; display:grid; place-items:center;}
  .panel{
    width:min(1200px, 92%); margin:40px auto 200px;
    background:#f7faff; border-radius:24px;
    box-shadow:inset 0 10px 18px rgba(0,0,0,.03), 0 18px 40px rgba(23,57,132,.08);
    padding:38px 36px;
  }
/* âœ¨ ì¹´ë“œ ì•ˆë‚´íŒ íš¨ê³¼ */
/* âœ¨ ì¹´ë“œ ì „ì²´ë¥¼ ë®ëŠ” íŒì—…í˜• ìŠ¤íƒ€ì¼ */
/* íŒ¨ë„ì„ ì˜¤ë²„ë ˆì´ ê¸°ì¤€ì ìœ¼ë¡œ */
/* íŒ¨ë„/ì˜¤ë²„ë ˆì´ ì•ˆì˜ íŠ¸ìœ„ëª¨ì§€ IMGëŠ” í•­ìƒ ì‘ê²Œ ê³ ì • */
.panel img.emoji,
.tile-overlay img.emoji,
.overlay-inner img.emoji {
  width: 24px !important;
  height: 24px !important;
  display: inline-block !important;
  vertical-align: -0.2em;
}

.tiles{display:grid; grid-template-columns:repeat(3,1fr); gap:18px;}

/* ê¸°ë³¸ ì¹´ë“œ */
.tile{
    background:#f9fbff; border-radius:18px; padding:50px; box-shadow:0 3px 0 #e3ecff inset, var(--shadow);
    display:flex; gap:14px; align-items:center; cursor:pointer; transition:transform .12s ease, box-shadow .12s ease;
    text-decoration:none; color:inherit;
  }

/* âœ… ì•„ì´ì½˜ ê¸°ë³¸ ì„¤ì • (í¬ê¸° ê³ ì • + ê²¹ì¹¨ ë°©ì§€) */
.tile .ic{width:56px; height:56px; border-radius:14px; display:grid; place-items:center; background:#e9f1ff; font-size:22px;}
.tile:hover{transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,0,0,.08)}
.tile .txt .k{font-weight:750}
.tile .txt .s{font-size:13px; color:var(--muted); margin-top:2px}

.tile .ic img,
.tile .ic svg,
.tile .ic span,
.tile .ic::before {
  width: 48px !important;
  height: 48px !important;
  object-fit: contain;
  flex-shrink: 0;
}

/* âœ… ì˜¤ë²„ë ˆì´ (ì²˜ìŒì—” ìˆ¨ê¹€) */
.tile-overlay {
  position: absolute;
  inset: 0;
  background: #fff;
  border-radius: 24px;
  opacity: 0;
  transform: scale(0.97);
  transition: all 0.4s ease;
  pointer-events: none;
}

/* ë‚´ë¶€ í…ìŠ¤íŠ¸ */
.overlay-inner {
  padding: 40px;
}

.overlay-inner h3 {
  font-size: 22px;
  margin-bottom: 20px;
}

.overlay-inner ul {
  font-size: 16px;
  line-height: 1.7;
  margin-bottom: 25px;
}

.open-btn {
  background: var(--brand, #1565d8);
  color: #fff;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
  cursor: pointer;
}
.tile .ic img,
.tile .ic svg,
.tile .ic span,
.tile .ic twemoji,
.tile .ic * {
  max-width: 48px !important;
  max-height: 48px !important;
  width: 48px !important;
  height: 48px !important;
  flex-shrink: 0 !important;
  object-fit: contain !important;
  transform: none !important; /* ë¶€ëª¨ transform ë¬´ì‹œ */
  position: relative !important;
  z-index: 2 !important;
}

/* í´ë¦­ ì‹œ content ì¤‘ì•™ì— ë§ì¶° í™•ëŒ€ */
.tile.active {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%) scale(1);
  width: min(1100px, 90%);
  height: 600px;
  background: #ffffff;
  border-radius: 24px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.18);
  z-index: 200;
  transition: all 0.4s ease;
  overflow: hidden;
}

/* ì•„ì´ì½˜ / í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸° */
.tile.active .txt,
.tile.active .ic {
  opacity: 0;
  visibility: hidden;
  transform: scale(0.9);
  transition: all 0.2s ease;
}

/* ë‚´ë¶€ í°ìƒ‰ íŒ¨ë„ */
.tile.active .tile-overlay {
  opacity: 1;
  pointer-events: auto;
  position: absolute;
  inset: 0;
  background: #fff;
  border-radius: 24px;
  transition: all 0.4s ease;
  box-shadow: none;
}

/* ë‚´ìš© ìì—°ìŠ¤ëŸ½ê²Œ ë“±ì¥ */
.tile.active .overlay-inner {
  opacity: 1;
  transform: translateY(0);
  transition: opacity 0.4s ease 0.1s, transform 0.4s ease 0.1s;
}

.tile .overlay-inner {
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.2s ease, transform 0.2s ease;
}

  /* ===== Assistant ===== */
  .assistant-wrap{
    position: fixed !important; bottom: 100px;
    left: calc(var(--sbw) + (100vw - var(--sbw)) / 2 - var(--assist-shift));
    transform: translateX(-50%); display:flex; align-items:flex-end; gap:0; z-index: 9999 !important;
    pointer-events: auto !important;
  }
  body.sidebar-closed .assistant-wrap{ left: calc(50% - var(--assist-shift)); transform: translateX(-50%); }
  .yang-stand{ width:400px; height:400px; object-fit:contain; filter:drop-shadow(0 12px 18px rgba(0,0,0,.22)); pointer-events:none; position:relative; top:100px; }
  .assistant-bar{ position:relative; height:64px; display:grid; grid-template-columns:120px 1fr 100px; align-items:center; gap:12px; background:#3c4250; color:#fff; border-radius:28px; padding:10px 12px; box-shadow:0 14px 30px rgba(0,0,0,.24); margin-left:-100px; width:min(860px, calc((100vw - var(--sbw)) - 300px - 70px)); transition:width .25s ease, margin-left .2s ease; pointer-events:auto; }
  .assistant-bar::after{ content:""; position:absolute; left:-10px; bottom:30px; width:18px; height:18px; background:#3c4250; transform:rotate(45deg); border-radius:3px; box-shadow:0 6px 12px rgba(0,0,0,.18); }
  body.sidebar-closed .assistant-bar{ width:min(960px, calc(100vw - 300px - 70px)); }
  .chip-icon{ width:40px; height:40px; border:none; border-radius:10px; background:rgba(255,255,255,.12); color:#fff; cursor:pointer; margin-right:6px; }
  .bar-left{display:flex; align-items:center}
  .bar-center input{ width:100%; height:44px; border:none; outline:none; background:rgba(255,255,255,.12); color:#fff; border-radius:12px; padding:0 12px; font-size:14px; }
  .mic, .send{ width:44px; height:44px; border:none; border-radius:12px; cursor:pointer; }
  .mic{ background:rgba(255,255,255,.12); color:#fff; margin-right:6px; }
  .send{ background:#00a2ff; color:#fff; font-weight:800; }

  /* === ğŸ’¬ ì±„íŒ… ë§í’ì„  UI === */
/* ğŸ’¬ ì±„íŒ… ë°•ìŠ¤ - ì‚¬ì´ë“œë°” êµ¬ì¡° ê¸°ì¤€ ì™„ë²½ ì •ë ¬ */
.chat-box {
  position: fixed !important;
  bottom: 155px; /* ğŸ”¥ ì…ë ¥ì°½ ìœ„ë¡œ ì •í™•íˆ ë„ìš°ê¸° */
  
  /* ì‚¬ì´ë“œë°” ìˆì„ ë•Œ */
  left: calc(var(--sbw) + (100vw - var(--sbw)) / 2 - var(--assist-shift));
  transform: translateX(-32%);
  
  width: min(840px, calc(100vw - var(--sbw) - 300px));
  max-height: 650px;
  overflow-y: auto; 
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0);
  z-index: 9999 !important; /* âœ… assistant-barë³´ë‹¤ ìœ„ */
  pointer-events: auto !important;
  
  display: flex;  
  flex-direction: column;
  gap: 10px;
  padding: 20px;
  transition: all 0.3s ease;
}
/* âœ… sectionë“¤ì´ ì±„íŒ…ì°½ ìœ„ë¥¼ ë®ì§€ ì•Šë„ë¡ */
section {
  position: relative;
  z-index: 1;
}
/* ì‚¬ì´ë“œë°” ë‹«í˜ ì‹œ ì¤‘ì•™ì •ë ¬ ìœ ì§€ */
body.sidebar-closed .chat-box {
  left: 52%;
  transform: translateX(-50%);
  width: min(900px, calc(100vw - 300px));
}
.msg.user {
  background: #1565d8;
  color: #fff;
  border-radius: 18px 18px 2px 18px;
  padding: 10px 16px;
  margin: 8px 0 8px auto;
  width: fit-content;
  max-width: 75%;
}
.msg.bot {
  background: #f1f5ff;
  color: #1f2a37;
  border-radius: 18px 18px 18px 2px;
  padding: 10px 16px;
  margin: 8px auto 8px 0;
  width: fit-content;
  max-width: 75%;
}


  /* ====== íƒœë¸”ë¦¿ ê·œì¹™ ====== */
  @media (max-width:1100px){
    .tiles{grid-template-columns:repeat(2,1fr)}
    .assistant-wrap{ bottom:110px; }
    .assistant-bar{ grid-template-columns:100px 1fr 88px; }
  }

  /* ====== ëª¨ë°”ì¼ ê·œì¹™(í•µì‹¬) ====== */
  @media (max-width:768px){
    :root{ --sbw: 78vw; --assist-shift:0px; }

    /* ì‚¬ì´ë“œë°”: ê¸°ë³¸ ì ‘í˜(ì˜¤ë²„ë ˆì´ ëª¨ë“œ) */
    .sidebar{
      transform: translateX(-100%);
      z-index:100;
    }
    body.sb-open .sidebar{ transform: translateX(0); }
    /* ë°°ê²½ ë”¤ */
    .sb-dim{
      position: fixed; inset:0; background:rgba(0,0,0,.35);
      z-index:90; display:none;
    }
    body.sb-open .sb-dim{ display:block; }

    /* ë©”ì¸ ì¢Œì—¬ë°± ì œê±° */
    .main{ margin-left:0 !important; }
    .content{ padding:16px !important; }

    /* íŒ¨ë„/íƒ€ì¼ ì¶•ì†Œ + 1ì—´ */
    .panel{
      width:100% !important; margin:12px auto 120px !important;
      padding:16px !important; border-radius:14px !important;
      box-shadow:0 6px 16px rgba(0,0,0,.06) !important; background:#fff !important;
    }
    .tiles{ grid-template-columns:1fr !important; gap:12px !important; }
    .tile{ padding:16px !important; border-radius:12px !important; }

    /* ìºë¦­í„° ìˆ¨ê¹€ + ì±„íŒ…ë°” ì¤‘ì•™ */
    .yang-stand{ display:none !important; }
    .assistant-wrap{
      left:50% !important; bottom:20px !important; transform:translateX(-50%) !important;
      z-index:40;
    }
    .assistant-bar{
      margin-left:0 !important;
      width:min(92vw, 680px) !important;
      grid-template-columns:90px 1fr 88px !important;
    }
    /* ì‚¬ì´ë“œë°” ì—´ë¦´ ë•Œ ì±„íŒ…ë°” ì•„ë˜ë¡œ */
    body.sb-open .assistant-wrap{ z-index:10; }
  }

  .sb-item .icon img.emoji{ width:16px; height:16px; display:block; }
  .tile .ic img.emoji{ width:28px; height:28px; display:block; }
  .chip-icon img.emoji, .mic img.emoji{ width:20px; height:20px; display:block; margin:0 auto; }
  
  /* === ì±„íŒ… ëª¨ë“œ ì „í™˜ === */
body.chatting .panel,
body.chatting .tiles {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

/* âš™ï¸ ì„¤ì • íŒ¨ë„ (ëª¨ë‹¬ íŒì—… ìŠ¤íƒ€ì¼) */
.settings-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45); /* ì–´ë‘ìš´ ë°°ê²½ íš¨ê³¼ */
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 300;
  animation: fadeIn 0.3s ease;
}

.settings-overlay.active {
  display: flex;
}

/* ğŸ¬ ì„¤ì •ì°½ í˜ì´ë“œì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
.settings-overlay.fade-out {
  animation: fadeOut 0.3s ease forwards;
}

@keyframes fadeOut {
  from { opacity: 1; transform: translateY(0); }
  to   { opacity: 0; transform: translateY(10px); } /* ì‚´ì§ ì•„ë˜ë¡œ ì‚¬ë¼ì§€ê²Œ */
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.settings-panel {
  background: #fff;
  padding: 40px 50px;
  border-radius: 24px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.25);
  width: min(600px, 90%);
  max-height: 85vh;
  overflow-y: auto;
  animation: popUp 0.3s ease;
}

@keyframes popUp {
  from { transform: translateY(30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.settings-panel h2 {
  font-size: 24px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.settings-panel .list {
  list-style: none;
  padding: 0;
  margin: 10px 0 20px;
}

.settings-panel .list li {
  background: #f9fbff;
  padding: 10px 16px;
  border-radius: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,.05);
}

.settings-panel .btn {
  padding: 10px 18px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: var(--brand, #1565d8);
  color: #fff;
  font-weight: 600;
}

.settings-panel .btn.danger {
  background: #e11d48;
}

/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ìŠ¤ìœ„ì¹˜ í† ê¸€ */
.switch {
  position: relative;
  display: inline-block;
  width: 46px;
  height: 24px;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0;
  right: 0; bottom: 0;
  background-color: #ccc;
  border-radius: 34px;
  transition: .3s;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px; width: 18px;
  left: 3px; bottom: 3px;
  background-color: white;
  border-radius: 50%;
  transition: .3s;
}
input:checked + .slider {
  background-color: var(--brand, #1565d8);
}
input:checked + .slider:before {
  transform: translateX(22px);
}
body, .panel, .tile, .settings-panel, .assistant-bar {
  transition: background-color 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œìš© í…ìŠ¤íŠ¸/ì¹´ë“œ ìƒ‰ìƒ ë³´ì • */
body.dark .tile,
body.dark .panel,
body.dark .settings-panel {
  background: #1f2937;  /* ì§™ì€ íšŒìƒ‰ ë°°ê²½ */
  color: #f3f4f6;       /* ë°ì€ í…ìŠ¤íŠ¸ */
  box-shadow: 0 10px 25px rgba(0,0,0,0.5);
}

body.dark .tile .txt .k {
  color: #f9fafb;  /* íƒ€ì´í‹€ í…ìŠ¤íŠ¸ */
}

body.dark .tile .txt .s {
  color: #9ca3af;  /* ì„œë¸Œ í…ìŠ¤íŠ¸ */
}

body.dark .panel h3,
body.dark .overlay-inner h3 {
  color: #f3f4f6;
}

body.dark .overlay-inner ul li {
  color: #e5e7eb;
}

/* ë²„íŠ¼ ë° ì…ë ¥ì°½ ëŒ€ë¹„ ì¡°ì • */
body.dark .open-btn {
  background: var(--brand);
  color: #fff;
}

body.dark .assistant-bar input {
  background: rgba(255,255,255,0.1);
  color: #f3f4f6;
}

body.dark .assistant-bar input::placeholder {
  color: #9ca3af;
}

/* ì„¤ì • ëª¨ë‹¬ ì•ˆ ë¦¬ìŠ¤íŠ¸/ë²„íŠ¼ ìƒ‰ìƒ */
body.dark .settings-panel .list li {
  background: #374151;
  color: #f3f4f6;
}

body.dark .settings-panel .btn.danger {
  background: #dc2626;
  color: #fff;
}

body.dark .settings-panel .btn {
  background: #2563eb;
  color: #fff;
}

/* ğŸ¤– ë´‡(ì–‘ë™ì´) ë©”ì‹œì§€ */
body.dark .msg.bot {
  background: #273449; /* ê¸°ì¡´ë³´ë‹¤ ì•½ê°„ ë°ê²Œ */
  color: #f9fafb;
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 3px 8px rgba(0,0,0,0.3);
}

/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ì±„íŒ… ë§í’ì„  ì‹œê° ê°œì„  */
body.dark .msg.user {
  background: linear-gradient(135deg, #3b82f6, #2563eb); /* ë” ì„ ëª…í•œ ë¸”ë£¨ */
  color: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.45);
}

body.dark .yang-stand {
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.6));
}
body, .panel, .tile, .settings-panel, .assistant-bar, .chat-box {
  transition: background-color 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ìƒë‹¨ë°” / ë²„íŠ¼ / ì‚¬ì´ë“œë°” ë³´ì • */
body.dark .topbar {
  background: #1f2937;  /* ì–´ë‘ìš´ íšŒìƒ‰ ë°°ê²½ */
  color: #f3f4f6;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
}

body.dark .topbar .title {
  color: #f9fafb;
}

body.dark .topbar .muted {
  color: #9ca3af;
}

/* ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìƒ‰ìƒ ë°˜ì „ */
body.dark .auth-btn {
  background: #2563eb;
  color: #fff;
}
body.dark .auth-btn:hover {
  background: #1d4ed8;
}

/* ğŸŒ™ ì‚¬ì´ë“œë°” ìƒ‰ìƒë„ ë‹¤í¬ëª¨ë“œì— ë§ê²Œ */
body.dark .sidebar {
  background: linear-gradient(180deg, #1e3a8a, #0f172a);
  color: #f9fafb;
}

body.dark .sb-item {
  color: #d1d5db;
}
body.dark .sb-item.active {
  background: #2563eb;
  color: #fff;
}
body.dark .sb-item:hover {
  background: rgba(255,255,255,0.1);
}

body.dark .sb-bottom .role {
  color: #9ca3af;
}

/* ğŸ’¡ ë¡œê³ ì™€ ì•„ì´ì½˜ ë°°ê²½ë„ ì¡°ê¸ˆ ì–´ë‘¡ê²Œ */
body.dark .logo img,
body.dark .sb-bottom img {
  background: #f3f4f6;
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ ìƒ‰ìƒ ë³´ì • */
body.dark .sb-toggle {
  color: #f3f4f6;              /* ë°ì€ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
  background: rgba(255,255,255,0.1); /* ì‚´ì§ ë°°ê²½ ë„£ì–´ì„œ ì‹œì¸ì„± í–¥ìƒ */
}
body.dark .sb-toggle:hover {
  background: rgba(255,255,255,0.2);
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ë³´ì¡° ì•„ì´ì½˜ ë²„íŠ¼ ìƒ‰ìƒ */
body.dark .chip-icon,
body.dark .mic {
  background: rgba(255,255,255,0.12);
  color: #f3f4f6;
}

body.dark .chip-icon:hover,
body.dark .mic:hover {
  background: rgba(255,255,255,0.22);
}

body.dark .send {
  background: #2563eb;
  color: #fff;
}
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ - ì±„íŒ… ì˜ì—­ ìŠ¤íƒ€ì¼ */
body.dark .chat-box {
  background: #0f172a;  /* ì „ì²´ ì±„íŒ… ë°°ê²½ */
  color: #f3f4f6;
}

/* ğŸ—¨ï¸ ì‚¬ìš©ì ë©”ì‹œì§€ */
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ì±„íŒ… ë§í’ì„  ì‹œê° ê°œì„  */
body.dark .msg.user {
  background: linear-gradient(135deg, #3b82f6, #2563eb); /* ë” ì„ ëª…í•œ ë¸”ë£¨ */
  color: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.45);
}

/* ğŸ¤– ë´‡(ì–‘ë™ì´) ë©”ì‹œì§€ */
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ë´‡ ë©”ì‹œì§€ ìƒ‰ìƒ ì™„ì „ í†µì¼ */
body.dark .msg.bot {
  background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
  color: #fff !important;
  border: none !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.45) !important;
}

/* âš ï¸ ì—ëŸ¬/ê²½ê³  ë©”ì‹œì§€ */
body.dark .msg.error {
  background: #b91c1c;
  color: #fff;
}

/* ğŸ’¬ ì…ë ¥ì°½ */
body.dark .assistant-bar {
  background: #1e293b;
  border-top: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 -2px 10px rgba(0,0,0,0.4);
}

/* ì…ë ¥ì°½ ë‚´ë¶€ input */
body.dark .assistant-bar input {
  background: rgba(255,255,255,0.08);
  color: #f3f4f6;
  border: none;
}
body.dark .assistant-bar input::placeholder {
  color: #9ca3af;
}

/* ì „ì†¡ ë²„íŠ¼ */
body.dark .assistant-bar button {
  background: #2563eb;
  color: #fff;
}
body.dark .assistant-bar button:hover {
  background: #1d4ed8;
}

/* âš™ï¸ í•˜ë‹¨ ì•„ì´ì½˜ ë²„íŠ¼ë“¤ (ì˜ˆ: ì„¤ì •, ìŒì„± ë“±) */
body.dark .assistant-bar .icon-btn {
  background: rgba(255,255,255,0.1);
  color: #f3f4f6;
}
body.dark .assistant-bar .icon-btn:hover {
  background: rgba(255,255,255,0.2);
}
/* ì±„íŒ… ì¤„ë°”ê¿ˆ/ê°œí–‰ ì²˜ë¦¬ + í•œêµ­ì–´ ë‹¨ì–´ ì¤„ë°”ê¿ˆ */
#chatBox { display:flex; flex-direction:column; gap:10px; }
#chatBox .msg { line-height:1.55; max-width:72%; }
#chatBox .msg .text {
  white-space: pre-line;     /* \n ì„ ì‹¤ì œ ì¤„ë°”ê¿ˆìœ¼ë¡œ */
  word-break: keep-all;      /* í•œêµ­ì–´ ë‹¨ì–´ ë‹¨ìœ„ ìœ ì§€ */
  overflow-wrap: anywhere;   /* ê¸¸~ê²Œ ë¶™ëŠ” URL/ì˜ë¬¸ë„ ì¤„ë°”ê¿ˆ */
}

/* ì¢Œìš° ì •ë ¬(ì›í•˜ë©´) */
#chatBox .msg.user { align-self:flex-end; background:#1565d8; padding:10px 12px; border-radius:16px; }
#chatBox .msg.bot  { align-self:flex-start; background:#dae3f7;    padding:10px 12px; border-radius:16px; }


/* âœ¨ í•œê¸€ ìëª¨ íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
.msg.bot.typing::after {
  content: "â–";  /* ê¹œë¹¡ì´ëŠ” ì»¤ì„œ ëª¨ì–‘ */
  display: inline-block;
  animation: blink 0.9s infinite;
  margin-left: 4px;
  opacity: 0.6;
}

@keyframes blink {
  0%, 50%, 100% { opacity: 0.6; }
  25%, 75% { opacity: 0; }
}

/* íƒ€ì´í•‘ ì¤‘ì¼ ë•Œ ë§í’ì„  ê°•ì¡° (ì„ íƒì‚¬í•­) */
.msg.bot.typing {
  background: #e8efff;
  box-shadow: 0 0 8px rgba(21, 101, 216, 0.15);
}

/* íƒ€ì´í•‘ ì¤‘ì—ë„ ë™ì¼ ìƒ‰ìƒ ìœ ì§€ */
/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ â€” ë´‡ íƒ€ì´í•‘ ì¤‘ì—ë„ ë™ì¼ ìƒ‰ìƒ ìœ ì§€ */
body.dark .msg.bot.typing {
  background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
  color: #fff !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.45) !important;
}

.log-card div {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 420px;
}
/* ========================= ì§€ë‚œ 7ì¼ ë¡œê·¸ - ëŒ€í™” ë§í’ì„  ========================= */
.msg-line {
  display: flex;
  align-items: center;
  margin: 10px 0;
  gap: 8px;
}

/* ë´‡ ë©”ì‹œì§€ */
.msg-line.bot {
  justify-content: flex-start;
}

.msg-line.bot .msg {
  background: #f3f4f6;           /* íšŒìƒ‰í†¤ (ë©”ì¸ ë´‡ê³¼ ë™ì¼) */
  color: #1f2a37;                /* í…ìŠ¤íŠ¸ ì§„íšŒìƒ‰ */
  border-radius: 18px 18px 18px 6px;
  padding: 10px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

/* ì‚¬ìš©ì ë©”ì‹œì§€ */
.msg-line.user {
  justify-content: flex-end;
}

.msg-line.user .msg {
  background: #1565d8;           /* ë¸Œëœë“œ íŒŒë‘ (#1565d8) */
  color: white;
  border-radius: 18px 18px 6px 18px;
  padding: 10px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

/* ì´ëª¨í‹°ì½˜ (ğŸ‘©â€ğŸ’» / ğŸ¤–) */
.icon {
  font-size: 20px;
  user-select: none;
}

/* ì´ëª¨í‹°ì½˜ ìœ„ì¹˜ ì •ë ¬ */
.msg-line.user .icon {
  order: 2;  /* ì˜¤ë¥¸ìª½ ë°°ì¹˜ */
  margin-left: 6px;
}

.msg-line.bot .icon {
  order: 1;  /* ì™¼ìª½ ë°°ì¹˜ */
  margin-right: 6px;
}

</style>
</head>
<body class="sidebar-closed">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-top">
      <div class="logo"><img src="image/yangdongi.png" alt="ì–‘ë™ì´"><span>ì–‘ë™ì´</span></div>
    </div>
    <nav class="sb-links">
    <!-- 1ï¸âƒ£ ìƒˆ ì±„íŒ… ë²„íŠ¼ -->
    <a class="sb-item active" id="newChatBtn" href="#">
      <span class="icon">ğŸ’¬</span>
      <span>ìƒˆ ì±„íŒ…</span>
    </a>
      <a class="sb-item" href="/" onclick="showMain()"><span class="icon">ğŸ </span><span>ë©”ì¸í˜ì´ì§€</span></a>
      <a class="sb-item" href="#" onclick="openRecentLogs()"><span class="icon">ğŸ“…</span><span>ì§€ë‚œ 7ì¼</span></a>
      <a class="sb-item" href="https://www.dongyang.ac.kr/dmu/index.do"><span class="icon">ğŸ“š</span><span>í•™êµ í™ˆí˜ì´ì§€</span></a>
      <a class="sb-item" href="#" onclick="showPersonalInfo()"><span class="icon">ğŸ‘¤</span><span>ê°œì¸ ì •ë³´</span></a>
      <a class="sb-item" href="https://www.dongyang.ac.kr/dmu/4749/subview.do"><span class="icon">ğŸ“</span><span>í•™ì‚¬ ì¼ì •</span></a>
      <a class="sb-item" id="settingsBtn" href="#"><span class="icon">âš™ï¸</span><span>ì„¤ì •</span>
</a>

    </nav>

    <!-- #ï¸âƒ£ ì‚¬ìš©ì ì •ë³´ê°€ ì±„ì›Œì§ˆ ì˜ì—­ -->
    <div class="sb-bottom" id="userBox">
      <img src="image/user.png" alt="ì‚¬ìš©ì">
      <div class="info">
        <div><strong id="userName">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</strong></div>
        <div class="role" id="userMeta">-</div>
      </div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <header class="topbar">
      <div class="left-group">
        <button class="sb-toggle" id="toggleBtn">â˜°</button>
        <div class="title">ì–‘ë™ì´ ì±—ë´‡ 1.0 </div>
      </div>

      <!-- #ï¸âƒ£ ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ìˆ¨ê¸¸ ë²„íŠ¼ -->
      <div class="right">
        <span class="muted" id="todayText"></span>
        <button id="authBtn" class="auth-btn"></button>
        <button id="logoutBtn" class="auth-btn" style="display:none">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </header>

<section class="content" id="dashboardView">
  <div class="board">
    <div class="panel">
      <div class="tiles">

<!-- âœ… ìˆ˜ì—… ì‹œê°„í‘œ ì¹´ë“œ -->
<!-- âœ… ìˆ˜ì—… ì‹œê°„í‘œ -->
<div class="tile">
  <div class="ic">ğŸ—“ï¸</div>
  <div class="txt">
    <div class="k">ìˆ˜ì—… ì‹œê°„í‘œ</div>
    <div class="s">ì´ë²ˆ ì£¼ ìˆ˜ì—… ë° ê°•ì˜ì‹¤</div>
  </div>

  <div class="tile-overlay">
    <div class="overlay-inner">
      <h3>ğŸ“… ì´ë²ˆ ì£¼ ìˆ˜ì—… ì‹œê°„í‘œ</h3>
      <ul>
        <li>ì›”ìš”ì¼ - ì•Œê³ ë¦¬ì¦˜ - 09:00 ~ 10:30 (C201)</li>
        <li>í™”ìš”ì¼ - ë°ì´í„°ë² ì´ìŠ¤ - 11:00 ~ 12:30 (A304)</li>
        <li>ìˆ˜ìš”ì¼ - ì¸ê³µì§€ëŠ¥ ê¸°ì´ˆ - 13:00 ~ 14:30 (B105)</li>
        <li>ëª©ìš”ì¼ - ì›¹í”„ë¡œê·¸ë˜ë° - 15:00 ~ 16:30 (D202)</li>
        <li>ê¸ˆìš”ì¼ - í”„ë¡œì íŠ¸ ì‹¤ìŠµ - 10:00 ~ 12:00 (Lab 2)</li>
      </ul>
      <button class="open-btn" onclick="window.location.href='feature.html?feature=schedule'"> ìì„¸íˆ ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- âœ… ìê²©ì¦ ì•ˆë‚´ -->
<div class="tile">
  <div class="ic">ğŸ§¾</div>
  <div class="txt">
    <div class="k">ìê²©ì¦ ì•ˆë‚´</div>
    <div class="s">ì¶”ì²œ ìê²©ì¦ / ì‹œí—˜ì¼ì •</div>
  </div>

  <div class="tile-overlay">
    <div class="overlay-inner">
      <h3>ğŸ§¾ ì¶”ì²œ ìê²©ì¦ & ì‹œí—˜ ì¼ì •</h3>
      <ul>
        <li>ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ - 2025.10.20 (ì ‘ìˆ˜ ë§ˆê°: 10.05)</li>
        <li>SQLD - 2025.11.12 (ì ‘ìˆ˜ ë§ˆê°: 10.30)</li>
        <li>ë¦¬ëˆ…ìŠ¤ë§ˆìŠ¤í„° 2ê¸‰ - 2025.12.03 (ì ‘ìˆ˜ ë§ˆê°: 11.20)</li>
      </ul>
      <button class="open-btn" onclick="window.location.href='feature.html?feature=license'"> ìì„¸íˆ ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- âœ… í•™ì  ì¡°íšŒ -->
<div class="tile">
  <div class="ic">ğŸ“Š</div>
  <div class="txt">
    <div class="k">í•™ì  ì¡°íšŒ</div>
    <div class="s">ëˆ„ì  / í•™ê¸°ë³„ ì„±ì </div>
  </div>

  <div class="tile-overlay">
    <div class="overlay-inner">
      <h3>ğŸ“Š í•™ì  ìš”ì•½</h3>
      <ul>
        <li>ëˆ„ì  í‰ê·  í•™ì : <strong>3.85 / 4.5</strong></li>
        <li>ì „ê³µ í‰ê·  í•™ì : 3.92</li>
        <li>êµì–‘ í‰ê·  í•™ì : 3.78</li>
      </ul>
      <button class="open-btn" onclick="window.location.href='feature.html?feature=grade'"> ìì„¸íˆ ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- âœ… eClass -->
<div class="tile">
  <div class="ic">ğŸ–¥ï¸</div>
  <div class="txt">
    <div class="k">eClass</div>
    <div class="s">ê³¼ì œ</div>
  </div>

  <div class="tile-overlay">
    <div class="overlay-inner">
      <h3>ğŸ–¥ï¸ ê³¼ì œ </h3>
      <ul>
        <li>[ê³¼ì œ] AI í”„ë¡œì íŠ¸ ë³´ê³ ì„œ â€“ ë§ˆê°: 2025.10.07</li>
        <li>[ê³¼ì œ] ë°ì´í„° ë¶„ì„ ì¤‘ê°„ ë³´ê³ ì„œ â€“ ë§ˆê°: 2025.10.10</li>
        <li>[ê³µì§€] ê¸°ë§ í”„ë¡œì íŠ¸ ë°œí‘œ â€“ 2025.12.01 ì˜ˆì •</li>
      </ul>
      <button class="open-btn" onclick="window.location.href='feature.html?feature=eclass'"> ìì„¸íˆ ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- âœ… ê³µì§€ì‚¬í•­ -->
<div class="tile">
  <div class="ic">ğŸ“¢</div>
  <div class="txt">
    <div class="k">ê³µì§€ì‚¬í•­</div>
    <div class="s">í•™êµ ê³µì§€ì‚¬í•­ / í•™ê³¼ ê³µì§€ì‚¬í•­</div>
  </div>

  <div class="tile-overlay">
    <div class="overlay-inner">
      <h3>ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
      <ul>
        <li>í•™êµ ê³µì§€ì‚¬í•­</li>
        <li>í•™ê³¼ ê³µì§€ì‚¬í•­</li>
        <li>----------</li>
      </ul>
      <button class="open-btn" onclick="window.location.href='feature.html?feature=library'"> ìì„¸íˆ ë³´ê¸°</button>
    </div>
  </div>
</div>

<!-- âœ… ì¡¸ì—… í•™ì  ì´ìˆ˜ -->
<div class="tile">
  <div class="ic">ğŸ“</div>
  <div class="txt">
    <div class="k">ì¡¸ì—… í•™ì  ì´ìˆ˜</div>
    <div class="s">ì „ê³µ / êµì–‘ ì´ìˆ˜ì²´í¬</div>
  </div>

  <div class="tile-overlay">
    <div class="overlay-inner">
      <h3>ğŸ“ ì¡¸ì—… ìš”ê±´ ì§„í–‰ ìƒí™©</h3>
      <ul>
        <li>ì „ê³µ ì´ìˆ˜: 78 / 80 í•™ì </li>
        <li>êµì–‘ ì´ìˆ˜: 28 / 30 í•™ì </li>
        <li>ì´ ì´ìˆ˜: 125 / 130 í•™ì </li>
      </ul>
      <button class="open-btn" onclick="window.location.href='feature.html?feature=graduate'"> ìì„¸íˆ ë³´ê¸°</button>
    </div>
  </div>
</div>

</section>

    
      <!-- âš™ï¸ ì„¤ì • íŒ¨ë„ (ì²˜ìŒì—” ìˆ¨ê¹€ ìƒíƒœ) -->
      <div class="settings-overlay" id="settingsOverlay">
  <div class="settings-panel">
    <h2> ì„¤ì •</h2>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
  <span style="font-weight:600;"> ë‹¤í¬ ëª¨ë“œ</span>
  <label class="switch">
    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode(this.checked)">
    <span class="slider"></span>
  </label>
</div>
    <hr style="margin:20px 0;border:none;border-top:1px solid #e5e7eb;">

    <h3> ì¦ê²¨ì°¾ê¸° ëª©ë¡</h3>
    <ul id="favList" class="list"></ul>

    <h3> ì±„íŒ… ê¸°ë¡</h3>
    <ul id="chatList" class="list"></ul>

    <div style="margin-top:20px; display:flex; justify-content:flex-end; gap:10px;">
      <button class="btn danger" onclick="clearChats()"> ëª¨ë“  ê¸°ë¡ ì‚­ì œ</button>
      <button class="btn" onclick="closeSettingsPanel()">ë‹«ê¸°</button>
    </div>
  </div>
</div>

    <!-- âœ… ì§€ë‚œ 7ì¼ ë¡œê·¸ ëª©ë¡ í™”ë©´ -->
<section id="recentLogsView" style="display:none; padding:20px;">
  <h2>ì§€ë‚œ 7ì¼ ëŒ€í™” ê¸°ë¡</h2>
  <div id="logsList"></div>
</section>
<!-- âœ… íŠ¹ì • ë‚ ì§œ ìƒì„¸ ëŒ€í™” í™”ë©´ -->
<section id="logsDetailView" style="display:none; padding:20px;">
  <button onclick="showRecentLogs()">â† ë’¤ë¡œê°€ê¸°</button>
  <h3 id="logsTitle"></h3>
  <div id="logsDetail"></div>
</section>
 
<!-- âœ… ê°œì¸ ì •ë³´ í™”ë©´ -->
<section id="personal-section" class="page" style="display:none; padding:20px;">
  <h2>ê°œì¸ ì •ë³´</h2>
  <div class="card" style="padding:15px; border-radius:10px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.05); max-width:400px;">
    <p><strong>ì´ë¦„:</strong> <span id="p-name"></span></p>
    <p><strong>í•™ë²ˆ:</strong> <span id="p-student"></span></p>
    <p><strong>í•™ê³¼:</strong> <span id="p-dept"></span></p>
    <p><strong>ì—­í• :</strong> <span id="p-role"></span></p>
    <p><strong>ì´ë©”ì¼:</strong> <span id="p-email"></span></p>

    <button onclick="showDashboard()" style="margin-top:15px;">â† ëŒì•„ê°€ê¸°</button>
  </div>
</section>


  </main>
  <!-- ğŸ’¬ ì±„íŒ… ë§í’ì„  ë°•ìŠ¤ -->
<div class="chat-box" id="chatBox"></div>

      <!-- Assistant -->
      <div class="assistant-wrap">
        <img class="yang-stand" src="image/yangdongi.png" alt="ì–‘ë™ì´">
        <div class="assistant-bar">
          <div class="bar-left">
            <button class="chip-icon">ğŸŒ</button>
            <button class="chip-icon">ğŸ“˜</button>
            <button class="chip-icon">âš™ï¸</button>
          </div>
          <div class="bar-center"><input id="ask" type="text" placeholder="ì•ˆë…•! ë‚œ ì–‘ë™ì´ì•¼. ì–´ë–¤ ì ì´ ê¶ê¸ˆí•´?" /></div>
          <div class="bar-right" style="display:flex;align-items:center;gap:6px;">
            <button class="mic">ğŸ™</button>
            <button class="send" >âœ</button>
          </div>
        </div>
      </div>
  <!-- ëª¨ë°”ì¼ ì˜¤ë²„ë ˆì´ ë”¤ -->
  <div class="sb-dim"></div>
  
<script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>
<script>
// ========================= ê¸°ë³¸ ìƒìˆ˜ =========================
const API_BASE     = "http://127.0.0.1:8001"; // Flask (ë¡œê·¸ ì ì¬ìš© í”„ë¡ì‹œ)
const FASTAPI_BASE = "http://127.0.0.1:9000"; // FastAPI (TTS/STT)

// ========================= ìœ í‹¸ =========================
function scrollChatToBottom() {
  const box = document.getElementById("chatBox");
  if (box) box.scrollTop = box.scrollHeight;
}
function escapeHTML(s=""){
  return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

// ğŸ”’ ì „ì†¡ ì¤‘ë³µ ë°©ì§€ ê°€ë“œ + ë˜í¼
let isSending = false;
async function safeSend() {
  if (isSending) return;
  isSending = true;
  try { await send(); } finally { isSending = false; }
}

// ========================= ë©”ì‹œì§€ ë Œë” =========================
// ì‚¬ìš©ì ë§í’ì„ 
function appendUserMessage(text) {
  const box = document.getElementById("chatBox");
  const wrap = document.createElement("div");
  wrap.className = "msg user";

  const textEl = document.createElement("div");
  textEl.className = "text";
  textEl.textContent = `ğŸ™‹ ${text}`;

  wrap.appendChild(textEl);
  box.appendChild(wrap);
  scrollChatToBottom();
}

// ë´‡ ë§í’ì„ 
function appendBotMessage(text) {
  const box = document.getElementById("chatBox");
  const msg = document.createElement("div");
  msg.className = "msg bot";

  msg.innerHTML = `
    <div class="text">${escapeHTML(text)}</div>
    <button class="tts-btn" style="margin-left:8px;border:none;background:transparent;cursor:pointer" title="ì½ì–´ì£¼ê¸°">ğŸ”Š</button>
  `;
  // TTS ë²„íŠ¼ í•¸ë“¤ëŸ¬
  const btn = msg.querySelector(".tts-btn");
  btn.addEventListener("click", () => playTTS(text));

  box.appendChild(msg);
  scrollChatToBottom();
}
/* ======= í•œê¸€ ì¡°ë¦½ ìœ í‹¸ ======= */
const Hangul = {
  disassemble: function(str) {
    const CHO = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
    const JUNG = ["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"];
    const JONG = ["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
    let result = [];
    for (let ch of str) {
      const code = ch.charCodeAt(0) - 0xac00;
      if (code >= 0 && code <= 11171) {
        const cho = Math.floor(code / 588);
        const jung = Math.floor((code - cho * 588) / 28);
        const jong = code % 28;
        result.push(CHO[cho], JUNG[jung]);
        if (JONG[jong] !== "") result.push(JONG[jong]);
      } else {
        result.push(ch);
      }
    }
    return result;
  },
  assemble: function(arr) {
    const CHO = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
    const JUNG = ["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"];
    const JONG = ["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];

    let result = "";
    let cho, jung, jong;
    function flush() {
      if (cho !== undefined && jung !== undefined) {
        const choIdx = CHO.indexOf(cho);
        const jungIdx = JUNG.indexOf(jung);
        const jongIdx = JONG.indexOf(jong || "");
        result += String.fromCharCode(0xac00 + choIdx * 588 + jungIdx * 28 + jongIdx);
      } else if (cho) result += cho;
      else if (jung) result += jung;
      cho = jung = jong = undefined;
    }

    for (let c of arr) {
      if (CHO.includes(c)) {
        if (cho && jung) flush();
        cho = c;
      } else if (JUNG.includes(c)) {
        if (!cho) cho = "ã…‡"; // ì´ˆì„± ì—†ì„ ë•Œ ìë™ ã…‡
        jung = c;
      } else if (JONG.includes(c)) {
        if (cho && jung && !jong) jong = c;
        else { flush(); cho = c; }
      } else {
        flush(); result += c;
      }
    }
    flush();
    return result;
  }
};
async function typeHangul(target, text, speed = 70) {
  const chars = Hangul.disassemble(text);
  let partial = [];
  for (let i = 0; i < chars.length; i++) {
    partial.push(chars[i]);
    target.innerText = Hangul.assemble(partial);
    await new Promise(r => setTimeout(r, speed));
  }
  target.innerText = text; // ì™„ì„±í˜•ìœ¼ë¡œ ë§ˆë¬´ë¦¬
}

/* ======= ë´‡ ë©”ì‹œì§€ ìƒì„± ======= */
async function appendBotMessage(text) {
  const chatBox = document.getElementById("chatBox");
  const bubble = document.createElement("div");
  bubble.className = "msg bot typing";
  chatBox.appendChild(bubble);
  chatBox.scrollTop = chatBox.scrollHeight;

  await typeHangul(bubble, text);
  bubble.classList.remove("typing");
}
/* ======= ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬ ======= */
document.querySelector(".send").addEventListener("click", () => {
  const input = document.getElementById("ask");
  const userText = input.value.trim();
  if (userText === "") return;

  const chatBox = document.getElementById("chatBox");
  const userBubble = document.createElement("div");
  userBubble.className = "msg user";
  userBubble.textContent = userText;
  chatBox.appendChild(userBubble);

  input.value = "";
  chatBox.scrollTop = chatBox.scrollHeight;

  // í…ŒìŠ¤íŠ¸ìš© ì‘ë‹µ
  setTimeout(() => appendBotMessage("ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì–‘ë™ì´ì—ìš” ğŸ¤–"), 600);
});

/* ======= ì—”í„°í‚¤ë¡œ ì „ì†¡ ======= */
document.getElementById("ask").addEventListener("keypress", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    document.querySelector(".send").click();
  }
});
// ========================= TTS =========================
async function playTTS(text) {
  try {
    const res = await fetch(`${FASTAPI_BASE}/tts`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });
    if (!res.ok) throw new Error("TTS ì„œë²„ ì˜¤ë¥˜");
    const data = await res.json();
    new Audio(`data:audio/mpeg;base64,${data.audio_b64}`).play();
  } catch (e) {
    appendBotMessage(`TTS ì‹¤íŒ¨: ${e.message}`);
  }
}

// ========================= STT(ë§ˆì´í¬) =========================
let mediaRecorder, audioChunks = [];
async function handleMicClick() {
  // ë‹¤ì‹œ ëˆ„ë¥´ë©´ ì¢…ë£Œ
  if (mediaRecorder && mediaRecorder.state === "recording") {
    mediaRecorder.stop();
    return;
  }
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
    mediaRecorder.onstop = async () => {
      const blob = new Blob(audioChunks, { type: "audio/webm" });
      const fd = new FormData();
      fd.append("file", blob, "voice.webm");

      const res = await fetch(`${FASTAPI_BASE}/voice-chat`, { method: "POST", body: fd });
      const d = await res.json();

      appendUserMessage(d.user_text || "ğŸ™ï¸(ìŒì„±)");
      appendBotMessage(d.assistant_text || "(ì‘ë‹µ ì—†ìŒ)");
    };
    mediaRecorder.start();
    alert("ğŸ™ï¸ ë…¹ìŒ ì‹œì‘! ë‹¤ì‹œ ëˆŒëŸ¬ ì¢…ë£Œí•©ë‹ˆë‹¤.");
  } catch (err) {
    alert("ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”!");
  }
}

// ========================= ì±„íŒ… ì „ì†¡ (ë‹¨ì¼ send) =========================
async function send() {
  const input = document.getElementById("ask");
  const text = (input.value || "").trim();
  if (!text) return;

  // ë©”ì¸ ì¹´ë“œ ê°€ë¦¬ê¸°(ëŒ€í™” ëª¨ë“œ ì „í™˜)
  document.body.classList.add("chatting");

  appendUserMessage(text);
  input.value = "";

  try {
    // ğŸ”— Flask í”„ë¡ì‹œ(/chat)ë¡œ ë³´ë‚´ì„œ DB ë¡œê·¸ ì ì¬ + FastAPI ì—°ê³„
    const chatRes = await fetch(`${API_BASE}/chat`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: text }),
      credentials: "include" // ì„¸ì…˜ ì¿ í‚¤ í¬í•¨(ë¡œê·¸ ì ì¬ì‹œ uid ì‹ë³„)
    });
    const data = await chatRes.json();
    const answer = data.answer || (data.msg ? `ì˜¤ë¥˜: ${data.msg}` : "(ì‘ë‹µ ì—†ìŒ)");
    appendBotMessage(answer);
  } catch (e) {
    appendBotMessage(`âš ï¸ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${e.message}`);
  }
}


// ========================= ìƒˆ ì±„íŒ… =========================
function resetChatView() {
  const chatBox = document.getElementById("chatBox");
  if (chatBox) chatBox.innerHTML = "";
  const msg = document.createElement("div");
  msg.className = "system-message";
  msg.style.textAlign = "center";
  msg.style.color = "#6b7280";
  msg.style.margin = "20px 0";
  msg.textContent = "ìƒˆë¡œìš´ ì±„íŒ…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.";
  chatBox.appendChild(msg);
}

// ========================= ì‚¬ì´ë“œë°”/í…Œë§ˆ/ì„¸ì…˜ =========================
function isMobile(){ return window.innerWidth <= 768; }
function closeAllSidebars(){ document.body.classList.remove('sb-open'); }

async function logout(){
  try {
    await fetch("/api/logout", { method:"POST", credentials:"include" }).catch(()=>{});
  } catch(_) {}
  localStorage.removeItem("isLoggedIn");
  localStorage.removeItem("isGuest");
  sessionStorage.clear();
  location.href = "login.html";
}
async function hydrateUserUI() {
  try {
    const res = await fetch("/api/me", { credentials: "include" });
    const data = await res.json().catch(()=> ({}));
    const btn = document.getElementById("authBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const nameEl = document.getElementById("userName");
    const metaEl = document.getElementById("userMeta");

    if (res.ok && data.ok && data.user) {
      const u = data.user;
      nameEl.textContent = u.name || "ì´ë¦„ ì—†ìŒ";
      metaEl.innerHTML = `${u.uid || "-"}<br>${u.department || "-"}`;
      if (btn) btn.style.display = "none";
      if (logoutBtn) { logoutBtn.style.display = "inline-flex"; logoutBtn.onclick = logout; }
    } else {
      if (btn) {
        btn.textContent = "ë¡œê·¸ì¸";
        btn.onclick = ()=> location.href="login.html";
        btn.style.display = "inline-flex";
      }
      if (logoutBtn) logoutBtn.style.display = "none";
    }
  } catch (e) {
    console.warn("ì„¸ì…˜ ì¡°íšŒ ì‹¤íŒ¨", e);
  }
}
function toggleDarkMode(isOn) {
  if (isOn) {
    document.body.classList.add("dark");
    localStorage.setItem("theme", "dark");
  } else {
    document.body.classList.remove("dark");
    localStorage.setItem("theme", "light");
  }
}
function restoreTheme() {
  const savedTheme = localStorage.getItem("theme");
  const darkToggle = document.getElementById("darkModeToggle");
  if (savedTheme === "dark") {
    document.body.classList.add("dark");
    if (darkToggle) darkToggle.checked = true;
  }
}

// ========================= ë¡œê·¸(ì§€ë‚œ 7ì¼) =========================
function openRecentLogs() {
  document.getElementById("recentLogsView").style.display = "block";
  document.getElementById("logsDetailView").style.display = "none";
  document.getElementById("dashboardView").style.display = "none";
  loadRecentLogs();
}
function showMain() {
  document.getElementById("recentLogsView").style.display = "none";
  document.getElementById("logsDetailView").style.display = "none";
  document.getElementById("dashboardView").style.display = "block";
}
function loadRecentLogs() {
  fetch("/api/chat/logs/7days", { credentials: "include" })
    .then(res => {
      if (res.status === 401) {
        const box = document.getElementById("logsList");
        box.innerHTML = `
          <div style="text-align:center; margin-top:60px; color:#6b7280;">
            ğŸ”’ <strong>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</strong><br><br>
            <button 
              onclick="location.href='login.html'" 
              style="background:#1565d8;color:#fff;border:none;
                     border-radius:8px;padding:10px 18px;font-size:15px;
                     cursor:pointer;transition:0.2s;"
              onmouseover="this.style.background='#0f4aa4'"
              onmouseout="this.style.background='#1565d8'">
              ë¡œê·¸ì¸í•˜ëŸ¬ ê°€ê¸° â†’
            </button>
          </div>`;
        return null;
      }
      return res.json();
    })
    .then(data => {
      if (!data) return;

      const box = document.getElementById("logsList");
      if (!data.ok || !data.days || data.days.length === 0) {
        box.innerHTML = "<p>ìµœê·¼ ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      box.innerHTML = data.days.map(d => `
        <div class="log-card" onclick="openLogDetail('${d.day}')">
          <strong>${d.day}</strong>
          <div style="color:#6b7280;font-size:14px;margin-top:4px;">
            ğŸ’¬ ${d.last_user_msg ? escapeHTML(d.last_user_msg) : "ìµœê·¼ ì§ˆë¬¸ ì—†ìŒ"}
          </div>
        </div>
      `).join("");
    })
    .catch(err => {
      console.error("ë¡œê·¸ ì¡°íšŒ ì˜¤ë¥˜:", err);
      document.getElementById("logsList").innerHTML =
        "<p style='color:red;'>âš ï¸ ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
    });
}
function openLogDetail(date) {
  document.getElementById("recentLogsView").style.display = "none";
  document.getElementById("logsDetailView").style.display = "block";
  document.getElementById("logsTitle").innerText = date;

  fetch(`/api/chat/logs/detail?date=${date}`, { credentials:"include" })
    .then(res => res.json())
    .then(data => {
      const box = document.getElementById("logsDetail");
      box.innerHTML = data.logs.map(log => {
        const icon = log.speaker === "user" ? "ğŸ‘©â€ğŸ’»" : "ğŸ¤–";
        return `
          <div class="msg-line ${log.speaker}">
            <span class="icon">${icon}</span>
            <span class="msg">${escapeHTML(log.message)}</span>
          </div>
        `;
      }).join("");
    });
}

function showRecentLogs() {
  document.getElementById("logsDetailView").style.display = "none";
  document.getElementById("recentLogsView").style.display = "block";
}

// ========================= DOMContentLoaded =========================
document.addEventListener('DOMContentLoaded', () => {
  // í¼ ê¸°ë³¸ submit ì°¨ë‹¨ (ì¤‘ë³µ ì „ì†¡ ë°©ì§€)
  document.addEventListener("submit", (e) => e.preventDefault());

  // Twemoji (ì „ì²´ 1íšŒ)
  twemoji.parse(document.body, { folder: 'svg', ext: '.svg' });

  // ë‚ ì§œ ì¶œë ¥
  const el = document.getElementById('todayText');
  const d = new Date(); const w = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
  if (el) el.textContent = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ${w}`;

  // ì‚¬ì´ë“œë°” í† ê¸€
  const toggleBtn = document.getElementById('toggleBtn');
  const dim = document.querySelector('.sb-dim');
  if (toggleBtn && !toggleBtn.dataset.bound) {
    toggleBtn.addEventListener('click', ()=>{
      if (isMobile()) document.body.classList.toggle('sb-open');
      else document.body.classList.toggle('sidebar-closed');
    });
    toggleBtn.dataset.bound = "1";
  }
  if (dim && !dim.dataset.bound) {
    dim.addEventListener('click', closeAllSidebars);
    dim.dataset.bound = "1";
  }
  window.addEventListener('resize', ()=>{
    if (isMobile()) document.body.classList.add('sidebar-closed');
    else document.body.classList.remove('sb-open');
  });

  // íƒ€ì¼(íŒ¨ë„) ì˜¤ë²„ë ˆì´
  const tiles = document.querySelectorAll('.tile');
  let activeTile = null;
  tiles.forEach(tile => {
    if (tile.dataset.bound) return;
    tile.addEventListener('click', (e) => {
      e.stopPropagation();
      if (tile.classList.contains('active')) {
        tile.classList.remove('active'); activeTile = null; return;
      }
      if (activeTile) activeTile.classList.remove('active');
      tile.classList.add('active'); activeTile = tile;
    });
    tile.dataset.bound = "1";
  });
  document.addEventListener('click', (e) => {
    if (activeTile && !activeTile.contains(e.target)) {
      activeTile.classList.remove('active'); activeTile = null;
    }
  });
   // ====================== ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¹€ ======================
  function hideAllSections() {
    document.querySelectorAll("section").forEach(sec => sec.style.display = "none");
  }

  // ====================== ì±„íŒ… ì‹œì‘ ì‹œ ë‹¤ë¥¸ ì„¹ì…˜ ìˆ¨ê¸°ê¸° ======================
  function showChatOnly() {
    hideAllSections(); // âœ… ì„¹ì…˜ ìˆ¨ê¸°ê¸°
    document.getElementById("chatBox")?.style.setProperty("display", "flex", "important");
    document.querySelector(".assistant-wrap")?.style.setProperty("display", "flex", "important");
    document.body.classList.add("chatting");
  }

  // ====================== ì „ì†¡ ë²„íŠ¼ê³¼ ì—°ê²° ======================
  const sendBtn2 = document.querySelector(".send");
  const askInput = document.getElementById("ask");

  if (sendBtn2) {
    sendBtn2.addEventListener("click", () => {
      showChatOnly();
      safeSend();
    });
  }

  if (askInput) {
    askInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        showChatOnly();
        safeSend();
      }
    });
  }

  // ====================== ìƒˆ ì±„íŒ… ë²„íŠ¼ ëˆŒëŸ¬ë„ ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸° ======================
  const newChatBtn2 = document.getElementById("newChatBtn");
  if (newChatBtn2) {
    newChatBtn2.addEventListener("click", (e) => {
      e.preventDefault();
      hideAllSections();
      resetChatView();
    });
  }

});
// ====================== ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¹€ (ì•ˆì „ ë³´ì •ìš©) ======================
function hideAllSections() {
  const allSections = document.querySelectorAll("section");
  allSections.forEach(sec => sec.style.display = "none");
}

// ====================== ì±„íŒ… ì‹œì‘ ì‹œ ë‹¤ë¥¸ ì„¹ì…˜ ìˆ¨ê¸°ê¸° ======================
function showChatOnly() {
  hideAllSections(); // âœ… ëª¨ë“  sectionì„ ë¨¼ì € ìˆ¨ê¹€

  // ì±„íŒ… ë°•ìŠ¤ë§Œ í‘œì‹œ
  const chatBox = document.getElementById("chatBox");
  const assistantWrap = document.querySelector(".assistant-wrap");
  if (chatBox) chatBox.style.display = "flex";
  if (assistantWrap) assistantWrap.style.display = "flex";

  document.body.classList.add("chatting");
}

// ====================== ì „ì†¡ ë²„íŠ¼ê³¼ ì—°ê²° ======================
const sendBtn2 = document.querySelector(".send");
const askInput = document.getElementById("ask");

if (sendBtn2) {
  sendBtn2.addEventListener("click", () => {
    showChatOnly();
    safeSend();
  });
}

if (askInput) {
  askInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      showChatOnly();
      safeSend();
    }
  });
}

// ====================== ìƒˆ ì±„íŒ… ë²„íŠ¼ ëˆŒëŸ¬ë„ ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸° ======================
const newChatBtn2 = document.getElementById("newChatBtn");
if (newChatBtn2) {
  newChatBtn2.addEventListener("click", (e) => {
    e.preventDefault();
    hideAllSections();
    resetChatView();
  });
}


  // ì„¸ì…˜/í…Œë§ˆ
  hydrateUserUI();
  restoreTheme();


  // ë§ˆì´í¬ ë²„íŠ¼
  const micBtn = document.querySelector(".mic");
  if (micBtn && !micBtn.dataset.bound) {
    micBtn.addEventListener("click", handleMicClick);
    micBtn.dataset.bound = "1";
  }

  // ìƒˆ ì±„íŒ… ë²„íŠ¼
  const newChatBtn = document.getElementById("newChatBtn");
  if (newChatBtn && !newChatBtn.dataset.bound) {
    newChatBtn.addEventListener("click", (e) => {
      e.preventDefault();
      resetChatView();
    });
    newChatBtn.dataset.bound = "1";
  }

  // ì„¤ì • ì—´ê¸° ë²„íŠ¼
  const settingsBtn = document.getElementById("settingsBtn");
  if (settingsBtn && !settingsBtn.dataset.bound) {
    settingsBtn.addEventListener("click", (e) => {
      e.preventDefault();
      document.getElementById("settingsOverlay").classList.add("active");
      renderChatSettings();
    });
    settingsBtn.dataset.bound = "1";
  }

  // ì„¤ì • íŒ¨ë„ ë‹«ê¸°(ë°°ê²½í´ë¦­)
  const settingsOverlay = document.getElementById("settingsOverlay");
  if (settingsOverlay && !settingsOverlay.dataset.bound) {
    settingsOverlay.addEventListener("click", (e) => {
      if (e.target.id === "settingsOverlay") {
        settingsOverlay.classList.remove("active");
      }
    });
    settingsOverlay.dataset.bound = "1";
  }


// âš™ï¸ ì„¤ì •ì°½ ë‹«ê¸° í•¨ìˆ˜ ë‹«ê¸° ë²„íŠ¼ ì•ˆëˆŒë ¤ì§€ëŠ”ê±° ìˆ˜ì • ì½”ë“œ
  function closeSettingsPanel() {
    const overlay = document.getElementById("settingsOverlay");
    if (overlay) {
      // 1ï¸âƒ£ í˜ì´ë“œì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì¶”ê°€
      overlay.classList.add("fade-out");

      // 2ï¸âƒ£ 0.3ì´ˆ í›„ ì™„ì „íˆ ë‹«ê¸°
      setTimeout(() => {
        overlay.classList.remove("active");
        overlay.classList.remove("fade-out");
      }, 300);
    }
  }
// ========================= ì„¤ì • íŒ¨ë„ ë³´ì¡° í•¨ìˆ˜ë“¤ =========================
function renderChatSettings() {
  const chats = JSON.parse(localStorage.getItem("chatHistory") || "[]");
  const favList = document.getElementById("favList");
  const chatList = document.getElementById("chatList");
  if (!favList || !chatList) return;

  favList.innerHTML = chats.filter(c=>c.favorite)
    .map(c=>`<li>${escapeHTML(c.date)} <button onclick="toggleFav('${c.id}')">â˜… í•´ì œ</button></li>`)
    .join("") || "<li>ì¦ê²¨ì°¾ê¸° ì—†ìŒ</li>";

  chatList.innerHTML = chats.map(c=>`
    <li>
      ${escapeHTML(c.date)}
      <span>
        <button onclick="toggleFav('${c.id}')">${c.favorite ? 'â˜…' : 'â˜†'}</button>
        <button onclick="deleteChat('${c.id}')">ì‚­ì œ</button>
      </span>
    </li>
  `).join("") || "<li>ì±„íŒ… ê¸°ë¡ ì—†ìŒ</li>";
}
function toggleFav(id) {
  let chats = JSON.parse(localStorage.getItem("chatHistory") || "[]");
  const chat = chats.find(c => c.id === id);
  if (chat) chat.favorite = !chat.favorite;
  localStorage.setItem("chatHistory", JSON.stringify(chats));
  renderChatSettings();
}
function deleteChat(id) {
  let chats = JSON.parse(localStorage.getItem("chatHistory") || "[]");
  chats = chats.filter(c => c.id !== id);
  localStorage.setItem("chatHistory", JSON.stringify(chats));
  renderChatSettings();
}
function clearChats() {
  if (confirm("ëª¨ë“  ì±„íŒ… ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    localStorage.removeItem("chatHistory");
    renderChatSettings();
  }
}


// ========================= ì‚¬ì´ë“œë°” ê°œì¸ì •ë³´ ë¶ˆëŸ¬ì˜¤ëŠ”ê±° =========================
async function showPersonalInfo() {
  // 1) API í˜¸ì¶œ
  const res = await fetch(`${API_BASE}/api/me`, { credentials: "include" });
  const data = await res.json();
  if (!data.ok) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");

  const u = data.user;

  // 2) ê°’ ë„£ê¸°
  document.getElementById('p-name').textContent = u.name;
  document.getElementById('p-student').textContent = u.uid;
  document.getElementById('p-dept').textContent = u.department;
  document.getElementById('p-role').textContent = u.role;
  document.getElementById('p-email').textContent = u.email;

  // 3) í™”ë©´ ì „í™˜
  document.getElementById("dashboardView").style.display = "none";
  document.getElementById("personal-section").style.display = "block";
}  // âœ… ì—¬ê¸°ì—ì„œ ë‹«ì•„ì•¼ í•¨!

// ========================= ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸° =========================
function showDashboard() {
  document.getElementById("personal-section").style.display = "none";
  document.getElementById("dashboardView").style.display = "block";
}

</script>


</body>
</html>