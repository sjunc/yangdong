# ================================================================
# guard.py
# ------------------------------------------------
# ğŸ›¡ï¸ ì—­í• :
# - ì‚¬ìš©ì ì…ë ¥ í…ìŠ¤íŠ¸ì— ìš•ì„¤, ë¹„ì†ì–´, ê°œì¸ì •ë³´(ì „í™”ë²ˆí˜¸/ì´ë©”ì¼ ë“±)ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ê°ì§€
# - LLM í˜¸ì¶œ ì „ì— í•„í„°ë§í•˜ì—¬ ì„œë¹„ìŠ¤ ì•ˆì „ì„± í™•ë³´
# ================================================================

import re

# âœ… ê¸ˆì§€ ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ (í•„ìš” ì‹œ í™•ì¥)
BAD_WORDS = ["ì”¨ë°œ", "ì¢†", "ê°œìƒˆ", "fuck", "shit"]

# âœ… ê°œì¸ì •ë³´ íŒ¨í„´ (ì •ê·œí‘œí˜„ì‹)
PII_PATTERNS = [
    r"\b\d{3}-\d{2}-\d{5}\b",   # ì£¼ë¯¼/í•™ë²ˆ ìœ ì‚¬ íŒ¨í„´ ì˜ˆì‹œ
    r"\b010-\d{4}-\d{4}\b",     # í•œêµ­ íœ´ëŒ€í° ë²ˆí˜¸
    r"[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+",  # ì´ë©”ì¼ ì£¼ì†Œ
]

def violates_policy(text: str) -> bool:
    """í…ìŠ¤íŠ¸ê°€ ê¸ˆì§€ì–´ ë˜ëŠ” ê°œì¸ì •ë³´ ê·œì¹™ì„ ìœ„ë°˜í•˜ëŠ”ì§€ í™•ì¸"""
    text = text.lower()
    if any(bad in text for bad in BAD_WORDS):
        return True
    for pat in PII_PATTERNS:
        if re.search(pat, text):
            return True
    return False
